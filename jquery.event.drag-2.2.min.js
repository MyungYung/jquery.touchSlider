/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
// Created: 2008-06-04 
// Updated: 2012-05-21
// REQUIRES: jquery 1.7.x

!function(e){e.fn.drag=function(t,a,n){var r="string"==typeof t?t:"",i=e.isFunction(t)?t:e.isFunction(a)?a:null;return 0!==r.indexOf("drag")&&(r="drag"+r),n=(t==i?a:n)||{},i?this.bind(r,n,i):this.trigger(r)};var t=e.event,a=t.special,n=a.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var a=e.data(this,n.datakey),r=t.data||{};a.related+=1,e.each(n.defaults,function(e,t){void 0!==r[e]&&(a[e]=r[e])})},remove:function(){e.data(this,n.datakey).related-=1},setup:function(){if(!e.data(this,n.datakey)){var a=e.extend({related:0},n.defaults);e.data(this,n.datakey,a),t.add(this,"touchstart mousedown",n.init,a),this.attachEvent&&this.attachEvent("ondragstart",n.dontstart)}},teardown:function(){var a=e.data(this,n.datakey)||{};a.related||(e.removeData(this,n.datakey),t.remove(this,"touchstart mousedown",n.init),n.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",n.dontstart))},init:function(r){if(!n.touched){var o,i=r.data;if(!(0!=r.which&&i.which>0&&r.which!=i.which)&&!e(r.target).is(i.not)&&(!i.handle||e(r.target).closest(i.handle,r.currentTarget).length)&&(n.touched="touchstart"==r.type?this:null,i.propagates=1,i.mousedown=this,i.interactions=[n.interaction(this,i)],i.target=r.target,i.pageX=r.pageX,i.pageY=r.pageY,i.dragging=null,o=n.hijack(r,"draginit",i),i.propagates))return o=n.flatten(o),o&&o.length&&(i.interactions=[],e.each(o,function(){i.interactions.push(n.interaction(this,i))})),i.propagates=i.interactions.length,i.drop!==!1&&a.drop&&a.drop.handler(r,i),n.textselect(!1),n.touched?t.add(n.touched,"touchmove touchend",n.handler,i):t.add(document,"mousemove mouseup",n.handler,i),!n.touched||i.live?!1:void 0}},interaction:function(t,a){var r=e(t)[a.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new n.callback,droppable:[],offset:r}},handler:function(r){var i=r.data;switch(r.type){case!i.dragging&&"touchmove":r.preventDefault();case!i.dragging&&"mousemove":if(Math.pow(r.pageX-i.pageX,2)+Math.pow(r.pageY-i.pageY,2)<Math.pow(i.distance,2))break;r.target=i.target,n.hijack(r,"dragstart",i),i.propagates&&(i.dragging=!0);case"touchmove":r.preventDefault();case"mousemove":if(i.dragging){if(n.hijack(r,"drag",i),i.propagates){i.drop!==!1&&a.drop&&a.drop.handler(r,i);break}r.type="mouseup"}case"touchend":case"mouseup":default:n.touched?t.remove(n.touched,"touchmove touchend",n.handler):t.remove(document,"mousemove mouseup",n.handler),i.dragging&&(i.drop!==!1&&a.drop&&a.drop.handler(r,i),n.hijack(r,"dragend",i)),n.textselect(!0),i.click===!1&&i.dragging&&e.data(i.mousedown,"suppress.click",(new Date).getTime()+5),i.dragging=n.touched=!1}},hijack:function(a,r,i,o,s){if(i){var c,p,h,d={event:a.originalEvent,type:a.type},l=r.indexOf("drop")?"drag":"drop",u=o||0,g=isNaN(o)?i.interactions.length:o;a.type=r,a.originalEvent=null,i.results=[];do if(p=i.interactions[u]){if("dragend"!==r&&p.cancelled)continue;h=n.properties(a,i,p),p.results=[],e(s||p[l]||i.droppable).each(function(o,s){return h.target=s,a.isPropagationStopped=function(){return!1},c=s?t.dispatch.call(s,a,h):null,c===!1?("drag"==l&&(p.cancelled=!0,i.propagates-=1),"drop"==r&&(p[l][o]=null)):"dropinit"==r&&p.droppable.push(n.element(c)||s),"dragstart"==r&&(p.proxy=e(n.element(c)||p.drag)[0]),p.results.push(c),delete a.result,"dropinit"!==r?c:void 0}),i.results[u]=n.flatten(p.results),"dropinit"==r&&(p.droppable=n.flatten(p.droppable)),"dragstart"!=r||p.cancelled||h.update()}while(++u<g);return a.type=d.type,a.originalEvent=d.event,n.flatten(i.results)}},properties:function(e,t,a){var r=a.callback;return r.drag=a.drag,r.proxy=a.proxy||a.drag,r.startX=t.pageX,r.startY=t.pageY,r.deltaX=e.pageX-t.pageX,r.deltaY=e.pageY-t.pageY,r.originalX=a.offset.left,r.originalY=a.offset.top,r.offsetX=r.originalX+r.deltaX,r.offsetY=r.originalY+r.deltaY,r.drop=n.flatten((a.drop||[]).slice()),r.available=n.flatten((a.droppable||[]).slice()),r},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?n.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",n.dontstart).css("MozUserSelect",t?"":"none"),document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};n.callback.prototype={update:function(){a.drop&&this.available.length&&e.each(this.available,function(e){a.drop.locate(this,e)})}};var r=t.dispatch;t.dispatch=function(t){return e.data(this,"suppress."+t.type)-(new Date).getTime()>0?void e.removeData(this,"suppress."+t.type):r.apply(this,arguments)};var i=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,a){if(a){var n=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0]||null;n&&e.each(i.props,function(e,a){t[a]=n[a]})}return t}};a.draginit=a.dragstart=a.dragend=n}(jQuery);